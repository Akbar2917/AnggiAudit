<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Audit Penjualan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media (max-width: 640px) {
            .feature-card {
                width: 100%;
                margin-bottom: 1rem;
            }
        }
        .sidebar {
            transition: all 0.3s;
        }
        .sidebar.collapsed {
            width: 4rem;
        }
        .sidebar.collapsed .nav-text {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Simulasi Login -->
    <div id="login-screen" class="fixed inset-0 flex items-center justify-center bg-gray-900 bg-opacity-75 z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md">
            <div class="flex justify-center mb-6">
                <svg class="w-16 h-16 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                </svg>
            </div>
            <h2 class="text-2xl font-bold text-center mb-6">Login Admin</h2>
            <form id="login-form" class="space-y-4">
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700">Username</label>
                    <input type="text" id="username" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="password" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Login
                </button>
            </form>
        </div>
    </div>



    <!-- Main Layout -->
    <div id="main-app" class="hidden min-h-screen flex">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar bg-blue-800 text-white w-64 min-h-screen p-4 flex flex-col">
            <div class="flex items-center justify-between mb-8">
                <h1 class="text-xl font-bold nav-text">Admin Penjualan</h1>
                <button id="toggle-sidebar" class="text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
            <nav class="flex-1">
                <ul class="space-y-2">
                    <li>
                        <a href="#" id="dashboard-link" class="flex items-center p-2 rounded hover:bg-blue-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
                            </svg>
                            <span class="nav-text ml-3">Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="daily-transaction-link" class="flex items-center p-2 rounded hover:bg-blue-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
                            </svg>
                            <span class="nav-text ml-3">Transaksi Harian</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="products-link" class="flex items-center p-2 rounded hover:bg-blue-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 2a4 4 0 00-4 4v1H5a1 1 0 00-.994.89l-1 9A1 1 0 004 18h12a1 1 0 00.994-1.11l-1-9A1 1 0 0015 7h-1V6a4 4 0 00-4-4zm2 5V6a2 2 0 10-4 0v1h4zm-6 3a1 1 0 112 0 1 1 0 01-2 0zm7-1a1 1 0 100 2 1 1 0 000-2z" clip-rule="evenodd" />
                            </svg>
                            <span class="nav-text ml-3">Produk</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="stock-link" class="flex items-center p-2 rounded hover:bg-blue-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
                            </svg>
                            <span class="nav-text ml-3">Stok</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" id="profit-link" class="flex items-center p-2 rounded hover:bg-blue-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z" />
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd" />
                            </svg>
                            <span class="nav-text ml-3">Keuntungan</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="mt-auto">
                <button id="logout-btn" class="flex items-center p-2 rounded hover:bg-blue-700 w-full">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M3 3a1 1 0 011 1v12a1 1 0 11-2 0V4a1 1 0 011-1zm7.707 3.293a1 1 0 010 1.414L9.414 10l1.293 1.293a1 1 0 11-1.414 1.414l-2-20a1 1 0 010-1.414l2-2a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                    <span class="nav-text ml-3">Logout</span>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-8">
            <!-- Dashboard Content (Default) -->
            <div id="dashboard-content">
                <h1 class="text-3xl font-bold mb-8">Dashboard Admin</h1>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-gray-500 font-medium">Total Produk</h3>
                        <p class="text-3xl font-bold" id="total-products">0</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-gray-500 font-medium">Stok Rendah</h3>
                        <p class="text-3xl font-bold" id="low-stock">0</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-gray-500 font-medium">Keuntungan Hari Ini</h3>
                        <p class="text-3xl font-bold" id="today-profit">Rp0</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-gray-500 font-medium">Barang Keluar Hari Ini</h3>
                        <p class="text-3xl font-bold" id="today-items-out">0</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold mb-4">Transaksi Hari Ini</h3>
                        <div id="today-transactions" class="space-y-3 max-h-64 overflow-y-auto">
                            <p class="text-gray-500">Belum ada transaksi hari ini</p>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold mb-4">Produk Terlaris Hari Ini</h3>
                        <div id="top-products-today" class="space-y-3">
                            <p class="text-gray-500">Belum ada penjualan hari ini</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Daily Transaction Content -->
            <div id="daily-transaction-content" class="hidden">
                <div class="flex justify-between items-center mb-8">
                    <h1 class="text-3xl font-bold">Transaksi Harian</h1>
                    <div class="flex space-x-3">
                        <button id="manage-expenses-btn" class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700">
                            ðŸ“Š Kelola Biaya
                        </button>
                        <button id="add-transaction-btn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            + Tambah Transaksi
                        </button>
                    </div>
                </div>

                <!-- Transaction Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8">
                    <div class="bg-white p-4 rounded-lg shadow">
                        <h3 class="text-gray-500 font-medium text-sm">Total Penjualan</h3>
                        <p class="text-xl font-bold text-green-600" id="daily-revenue">Rp0</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <h3 class="text-gray-500 font-medium text-sm">Modal</h3>
                        <p class="text-xl font-bold text-red-600" id="daily-cost">Rp0</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <h3 class="text-gray-500 font-medium text-sm">Keuntungan Kotor</h3>
                        <p class="text-xl font-bold text-blue-600" id="daily-gross-profit">Rp0</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <h3 class="text-gray-500 font-medium text-sm">Biaya Operasional</h3>
                        <p class="text-xl font-bold text-orange-600" id="daily-expenses">Rp0</p>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow">
                        <h3 class="text-gray-500 font-medium text-sm">Keuntungan Bersih</h3>
                        <p class="text-xl font-bold text-purple-600" id="daily-net-profit">Rp0</p>
                    </div>
                </div>

                <!-- Date Filter -->
                <div class="bg-white p-4 rounded-lg shadow mb-6">
                    <div class="flex items-center space-x-4">
                        <label for="transaction-date" class="text-sm font-medium text-gray-700">Pilih Tanggal:</label>
                        <input type="date" id="transaction-date" class="px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        <button id="filter-transaction-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                            Filter
                        </button>
                        <button id="today-transaction-btn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">
                            Hari Ini
                        </button>
                    </div>
                </div>

                <!-- Expenses Modal -->
                <div id="expenses-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50">
                    <div class="bg-white p-8 rounded-lg w-full max-w-md max-h-[90vh] overflow-y-auto">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-bold">Kelola Biaya Operasional</h2>
                            <button id="close-expenses-modal" class="text-gray-500 hover:text-gray-700">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        
                        <div class="mb-6">
                            <label for="expense-date" class="block text-sm font-medium text-gray-700">Tanggal</label>
                            <input type="date" id="expense-date" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <form id="expenses-form">
                            <div class="space-y-4">
                                <div>
                                    <label for="tax-expense" class="block text-sm font-medium text-gray-700">adm shoope (Rp)</label>
                                    <input type="number" id="tax-expense" min="0" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label for="ads-expense" class="block text-sm font-medium text-gray-700">Iklan & Marketing (Rp)</label>
                                    <input type="number" id="ads-expense" min="0" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label for="utility-expense" class="block text-sm font-medium text-gray-700">Gaji Karyawan (Rp)</label>
                                    <input type="number" id="utility-expense" min="0" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label for="shipping-expense" class="block text-sm font-medium text-gray-700">Ongkos Kirim (Rp)</label>
                                    <input type="number" id="shipping-expense" min="0" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label for="other-expense" class="block text-sm font-medium text-gray-700">Biaya Lainnya (Rp)</label>
                                    <input type="number" id="other-expense" min="0" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label for="expense-notes" class="block text-sm font-medium text-gray-700">Catatan</label>
                                    <textarea id="expense-notes" rows="2" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                                </div>
                            </div>
                            <div class="mt-6 flex justify-end space-x-3">
                                <button type="button" id="cancel-expenses" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
                                    Batal
                                </button>
                                <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-orange-600 hover:bg-orange-700">
                                    Simpan Biaya
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Transaction Modal -->
                <div id="transaction-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50">
                    <div class="bg-white p-8 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-bold">Tambah Transaksi Baru</h2>
                            <button id="close-transaction-modal" class="text-gray-500 hover:text-gray-700">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        <form id="transaction-form">
                            <div class="space-y-4">
                                <div>
                                    <label for="transaction-type" class="block text-sm font-medium text-gray-700">Jenis Transaksi</label>
                                    <select id="transaction-type" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                        <option value="out">Barang Keluar (Penjualan)</option>
                                        <option value="in">Barang Masuk (Restock)</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="transaction-product" class="block text-sm font-medium text-gray-700">Pilih Produk</label>
                                    <select id="transaction-product" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                        <!-- Products will be loaded here -->
                                    </select>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label for="transaction-color" class="block text-sm font-medium text-gray-700">Warna</label>
                                        <input type="text" id="transaction-color" placeholder="Contoh: Merah, Biru, Hitam" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label for="transaction-size" class="block text-sm font-medium text-gray-700">Ukuran</label>
                                        <input type="text" id="transaction-size" placeholder="Contoh: S, M, L, XL, 40, 42" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                </div>
                                <div>
                                    <label for="transaction-quantity" class="block text-sm font-medium text-gray-700">Jumlah</label>
                                    <input type="number" id="transaction-quantity" min="1" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div id="sale-price-container" class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label for="transaction-price" class="block text-sm font-medium text-gray-700">Harga Jual (per unit)</label>
                                        <input type="number" id="transaction-price" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label for="transaction-cost" class="block text-sm font-medium text-gray-700">Modal (per unit)</label>
                                        <input type="number" id="transaction-cost" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                </div>
                                <div>
                                    <label for="transaction-customer" class="block text-sm font-medium text-gray-700">Nama Pembeli (opsional)</label>
                                    <input type="text" id="transaction-customer" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label for="transaction-notes" class="block text-sm font-medium text-gray-700">Catatan (opsional)</label>
                                    <textarea id="transaction-notes" rows="2" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                                </div>
                            </div>
                            <div class="mt-6 flex justify-end space-x-3">
                                <button type="button" id="cancel-transaction" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
                                    Batal
                                </button>
                                <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">
                                    Simpan Transaksi
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Transaction Table -->
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Waktu</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jenis</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Produk</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Warna</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ukuran</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jumlah</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Keuntungan</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pembeli</th>
                                </tr>
                            </thead>
                            <tbody id="transaction-table-body" class="bg-white divide-y divide-gray-200">
                                <!-- Transaction data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Daily Summary by Color/Size -->
                <div class="mt-8 grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold mb-4">Ringkasan per Warna</h3>
                        <div id="color-summary" class="space-y-2">
                            <!-- Color summary will be loaded here -->
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold mb-4">Ringkasan per Ukuran</h3>
                        <div id="size-summary" class="space-y-2">
                            <!-- Size summary will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Content -->
            <div id="products-content" class="hidden">
                <div class="flex justify-between items-center mb-8">
                    <h1 class="text-3xl font-bold">Manajemen Produk</h1>
                    <button id="add-product-btn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                        + Tambah Produk
                    </button>
                </div>

                <!-- Product Modal -->
                <div id="product-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50">
                    <div class="bg-white p-8 rounded-lg w-full max-w-md">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-bold" id="modal-title">Tambah Produk Baru</h2>
                            <button id="close-product-modal" class="text-gray-500 hover:text-gray-700">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                        <form id="product-form">
                            <input type="hidden" id="product-id">
                            <div class="space-y-4">
                                <div>
                                    <label for="product-name" class="block text-sm font-medium text-gray-700">Nama Produk</label>
                                    <input type="text" id="product-name" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label for="product-price" class="block text-sm font-medium text-gray-700">Harga Jual (Rp)</label>
                                    <input type="number" id="product-price" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label for="product-cost" class="block text-sm font-medium text-gray-700">Modal (Rp)</label>
                                    <input type="number" id="product-cost" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label for="product-stock" class="block text-sm font-medium text-gray-700">Stok Awal</label>
                                    <input type="number" id="product-stock" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label for="product-category" class="block text-sm font-medium text-gray-700">Kategori</label>
                                    <select id="product-category" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                        <option value="pakaian">Pakaian</option>
                                        <option value="sepatu">Sepatu</option>
                                        <option value="aksesoris">Aksesoris</option>
                                        <option value="elektronik">Elektronik</option>
                                        <option value="lainnya">Lainnya</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mt-6 flex justify-end space-x-3">
                                <button type="button" id="cancel-product" class="px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">
                                    Batal
                                </button>
                                <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700">
                                    Simpan
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Product Table -->
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kategori</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Harga Jual</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Modal</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stok</th>
                                    <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="product-table-body" class="bg-white divide-y divide-gray-200">
                                <!-- Product data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Stock Content -->
            <div id="stock-content" class="hidden">
                <h1 class="text-3xl font-bold mb-8">Manajemen Stok</h1>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold mb-4">Penyesuaian Stok</h3>
                        <form id="stock-adjustment-form" class="space-y-4">
                            <div>
                                <label for="adjust-product" class="block text-sm font-medium text-gray-700">Pilih Produk</label>
                                <select id="adjust-product" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    <!-- Products will be loaded here -->
                                </select>
                            </div>
                            <div>
                                <label for="adjust-type" class="block text-sm font-medium text-gray-700">Jenis Penyesuaian</label>
                                <select id="adjust-type" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                    <option value="add">Tambah Stok</option>
                                    <option value="subtract">Kurangi Stok</option>
                                    <option value="set">Set Jumlah Stok</option>
                                </select>
                            </div>
                            <div>
                                <label for="adjust-amount" class="block text-sm font-medium text-gray-700">Jumlah</label>
                                <input type="number" id="adjust-amount" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="adjust-notes" class="block text-sm font-medium text-gray-700">Catatan (opsional)</label>
                                <textarea id="adjust-notes" rows="2" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                            </div>
                            <div class="pt-4">
                                <button type="submit" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                    Proses Penyesuaian
                                </button>
                            </div>
                        </form>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold mb-4">Riwayat Penyesuaian</h3>
                        <div id="stock-history" class="space-y-3 max-h-96 overflow-y-auto">
                            <!-- Stock history will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profit Content -->
            <div id="profit-content" class="hidden">
                <h1 class="text-3xl font-bold mb-8">Laporan Keuntungan</h1>
                
                <div class="bg-white p-6 rounded-lg shadow mb-6">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
                        <div>
                            <h3 class="text-lg font-medium">Filter Laporan</h3>
                            <p class="text-sm text-gray-500">Pilih periode untuk melihat laporan keuntungan</p>
                        </div>
                        <div class="mt-4 md:mt-0">
                            <form id="profit-filter" class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                                <input type="date" id="filter-start-date" class="px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                <input type="date" id="filter-end-date" class="px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                                <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                                    Filter
                                </button>
                                <button type="button" id="reset-filter" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">
                                    Reset
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="text-sm font-medium text-green-800">Total Pendapatan</h4>
                            <p class="text-2xl font-bold text-green-600" id="total-revenue">Rp0</p>
                        </div>
                        <div class="bg-red-50 p-4 rounded-lg">
                            <h4 class="text-sm font-medium text-red-800">Total Modal</h4>
                            <p class="text-2xl font-bold text-red-600" id="total-cost">Rp0</p>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <h4 class="text-sm font-medium text-orange-800">Total Biaya Operasional</h4>
                            <p class="text-2xl font-bold text-orange-600" id="total-expenses">Rp0</p>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="text-sm font-medium text-blue-800">Total Keuntungan Bersih</h4>
                            <p class="text-2xl font-bold text-blue-600" id="total-profit">Rp0</p>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pendapatan</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Modal</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Biaya Operasional</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Keuntungan Bersih</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Transaksi</th>
                                </tr>
                            </thead>
                            <tbody id="profit-table-body" class="bg-white divide-y divide-gray-200">
                                <!-- Profit data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase Modules -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js';
        import { getDatabase, ref, set, get, push, onValue } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js';

        // Konfigurasi Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAxyWNYsGStyuxpbLfF1wWcRQbsgKccwO0",
            authDomain: "audit-f3c98.firebaseapp.com",
            databaseURL: "https://audit-f3c98-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "audit-f3c98",
            storageBucket: "audit-f3c98.firebasestorage.app",
            messagingSenderId: "3570615755",
            appId: "1:3570615755:web:8f6468251848c8bae7224e",
            measurementId: "G-5W7ZYQ3P8K"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        // Make Firebase available globally
        window.firebaseDB = {
            database,
            ref,
            set,
            get,
            push,
            onValue
        };

        // Initialize default data if needed
        async function initializeDefaultData() {
            try {
                // Check if users exist
                const usersSnapshot = await get(ref(database, 'users'));
                if (!usersSnapshot.exists()) {
                    await set(ref(database, 'users'), [
                        { username: 'admin', password: 'admin123' }
                    ]);
                }

                // Check if products exist
                const productsSnapshot = await get(ref(database, 'products'));
                if (!productsSnapshot.exists()) {
                    const sampleProducts = [
                        { id: 1, name: 'Kaos Polos', price: 75000, cost: 45000, stock: 50, category: 'pakaian' },
                        { id: 2, name: 'Kemeja Formal', price: 150000, cost: 90000, stock: 30, category: 'pakaian' },
                        { id: 3, name: 'Celana Jeans', price: 200000, cost: 120000, stock: 25, category: 'pakaian' },
                        { id: 4, name: 'Sepatu Sneakers', price: 350000, cost: 250000, stock: 20, category: 'sepatu' }
                    ];
                    await set(ref(database, 'products'), sampleProducts);
                }

                console.log('Firebase initialized successfully');
            } catch (error) {
                console.error('Error initializing default data:', error);
            }
        }

        // Initialize data when the page loads
        initializeDefaultData();
    </script>

    <!-- Main Application Script -->
    <script>
        // Wait for Firebase to be available
        setTimeout(() => {
            if (!window.firebaseDB) {
                console.error('Firebase not initialized');
                return;
            }

            const { database, ref, set, get, push, onValue } = window.firebaseDB;

            // DOM elements
            const loginScreen = document.getElementById('login-screen');
            const loginForm = document.getElementById('login-form');
            const mainApp = document.getElementById('main-app');
            const toggleSidebar = document.getElementById('toggle-sidebar');
            const sidebar = document.getElementById('sidebar');
            const logoutBtn = document.getElementById('logout-btn');
            
            // Navigation links
            const dashboardLink = document.getElementById('dashboard-link');
            const dailyTransactionLink = document.getElementById('daily-transaction-link');
            const productsLink = document.getElementById('products-link');
            const stockLink = document.getElementById('stock-link');
            const profitLink = document.getElementById('profit-link');
            
            // Content sections
            const dashboardContent = document.getElementById('dashboard-content');
            const dailyTransactionContent = document.getElementById('daily-transaction-content');
            const productsContent = document.getElementById('products-content');
            const stockContent = document.getElementById('stock-content');
            const profitContent = document.getElementById('profit-content');
            
            // Transaction elements
            const addTransactionBtn = document.getElementById('add-transaction-btn');
            const transactionModal = document.getElementById('transaction-modal');
            const closeTransactionModal = document.getElementById('close-transaction-modal');
            const transactionForm = document.getElementById('transaction-form');
            const transactionTableBody = document.getElementById('transaction-table-body');
            const transactionProductSelect = document.getElementById('transaction-product');
            const transactionType = document.getElementById('transaction-type');
            const salePriceContainer = document.getElementById('sale-price-container');
            
            // Expenses elements
            const manageExpensesBtn = document.getElementById('manage-expenses-btn');
            const expensesModal = document.getElementById('expenses-modal');
            const closeExpensesModal = document.getElementById('close-expenses-modal');
            const expensesForm = document.getElementById('expenses-form');
            
            // Products elements
            const addProductBtn = document.getElementById('add-product-btn');
            const productModal = document.getElementById('product-modal');
            const closeProductModal = document.getElementById('close-product-modal');
            const productForm = document.getElementById('product-form');
            const productTableBody = document.getElementById('product-table-body');
            
            // Stock elements
            const stockAdjustmentForm = document.getElementById('stock-adjustment-form');
            const adjustProductSelect = document.getElementById('adjust-product');
            const stockHistory = document.getElementById('stock-history');
            
            // Profit elements
            const profitFilter = document.getElementById('profit-filter');
            const profitTableBody = document.getElementById('profit-table-body');

            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('transaction-date').value = today;
            document.getElementById('expense-date').value = today;

            // Login handler
            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                try {
                    const snapshot = await get(ref(database, 'users'));
                    const users = snapshot.val() || [];
                    const user = users.find(u => u.username === username && u.password === password);
                    
                    if (user) {
                        loginScreen.classList.add('hidden');
                        mainApp.classList.remove('hidden');
                        loadDashboard();
                        updateProductSelects();
                    } else {
                        alert('Username atau password salah!');
                    }
                } catch (error) {
                    console.error("Gagal mengambil data users:", error);
                    alert('Terjadi kesalahan saat login. Silakan coba lagi.');
                }
            });

            // Logout handler
            logoutBtn.addEventListener('click', function() {
                mainApp.classList.add('hidden');
                loginScreen.classList.remove('hidden');
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
            });
            
            // Toggle sidebar
            toggleSidebar.addEventListener('click', function() {
                sidebar.classList.toggle('collapsed');
            });
            
            // Navigation handlers
            dashboardLink.addEventListener('click', function(e) {
                e.preventDefault();
                hideAllContent();
                dashboardContent.classList.remove('hidden');
                loadDashboard();
            });
            
            dailyTransactionLink.addEventListener('click', function(e) {
                e.preventDefault();
                hideAllContent();
                dailyTransactionContent.classList.remove('hidden');
                loadDailyTransactions();
            });
            
            productsLink.addEventListener('click', function(e) {
                e.preventDefault();
                hideAllContent();
                productsContent.classList.remove('hidden');
                loadProducts();
            });
            
            stockLink.addEventListener('click', function(e) {
                e.preventDefault();
                hideAllContent();
                stockContent.classList.remove('hidden');
                loadStockHistory();
                updateProductSelects();
            });
            
            profitLink.addEventListener('click', function(e) {
                e.preventDefault();
                hideAllContent();
                profitContent.classList.remove('hidden');
                loadProfitData();
            });
            
            // Expenses management
            manageExpensesBtn.addEventListener('click', function() {
                expensesForm.reset();
                document.getElementById('expense-date').value = document.getElementById('transaction-date').value;
                loadCurrentExpenses();
                expensesModal.classList.remove('hidden');
            });
            
            closeExpensesModal.addEventListener('click', function() {
                expensesModal.classList.add('hidden');
            });
            
            document.getElementById('cancel-expenses').addEventListener('click', function() {
                expensesModal.classList.add('hidden');
            });
            
            // Expenses form handler
            expensesForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const expenseDate = document.getElementById('expense-date').value;
                const taxExpense = parseInt(document.getElementById('tax-expense').value) || 0;
                const adsExpense = parseInt(document.getElementById('ads-expense').value) || 0;
                const rentExpense = parseInt(document.getElementById('rent-expense').value) || 0;
                const utilityExpense = parseInt(document.getElementById('utility-expense').value) || 0;
                const shippingExpense = parseInt(document.getElementById('shipping-expense').value) || 0;
                const otherExpense = parseInt(document.getElementById('other-expense').value) || 0;
                const expenseNotes = document.getElementById('expense-notes').value;
                
                const totalExpenses = taxExpense + adsExpense + rentExpense + utilityExpense + shippingExpense + otherExpense;
                
                try {
                    const expenseData = {
                        date: expenseDate,
                        tax: taxExpense,
                        ads: adsExpense,
                        rent: rentExpense,
                        utility: utilityExpense,
                        shipping: shippingExpense,
                        other: otherExpense,
                        total: totalExpenses,
                        notes: expenseNotes,
                        timestamp: Date.now(),
                        user: 'Admin'
                    };
                    
                    await set(ref(database, `expenses/${expenseDate}`), expenseData);
                    
                    alert('Biaya operasional berhasil disimpan!');
                    expensesModal.classList.add('hidden');
                    
                    // Reload transaction data if viewing the same date
                    if (document.getElementById('transaction-date').value === expenseDate) {
                        loadDailyTransactions();
                    }
                    loadDashboard();
                } catch (error) {
                    console.error("Gagal menyimpan biaya operasional:", error);
                    alert('Terjadi kesalahan saat menyimpan biaya.');
                }
            });
            
            // Transaction management
            addTransactionBtn.addEventListener('click', function() {
                transactionForm.reset();
                document.getElementById('transaction-type').value = 'out';
                salePriceContainer.style.display = 'grid';
                transactionModal.classList.remove('hidden');
            });
            
            closeTransactionModal.addEventListener('click', function() {
                transactionModal.classList.add('hidden');
            });
            
            document.getElementById('cancel-transaction').addEventListener('click', function() {
                transactionModal.classList.add('hidden');
            });
            
            // Transaction type change handler
            transactionType.addEventListener('change', function() {
                if (this.value === 'in') {
                    salePriceContainer.style.display = 'none';
                } else {
                    salePriceContainer.style.display = 'grid';
                }
            });
            
            // Transaction form handler
            transactionForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const type = document.getElementById('transaction-type').value;
                const productId = parseInt(document.getElementById('transaction-product').value);
                const color = document.getElementById('transaction-color').value;
                const size = document.getElementById('transaction-size').value;
                const quantity = parseInt(document.getElementById('transaction-quantity').value);
                const price = type === 'out' ? parseInt(document.getElementById('transaction-price').value) : 0;
                const cost = type === 'out' ? parseInt(document.getElementById('transaction-cost').value) : 0;
                const customer = document.getElementById('transaction-customer').value;
                const notes = document.getElementById('transaction-notes').value;
                
                try {
                    const productsSnapshot = await get(ref(database, 'products'));
                    let products = productsSnapshot.val() || [];
                    const productIndex = products.findIndex(p => p.id == productId);
                    
                    if (productIndex === -1) {
                        alert('Produk tidak ditemukan!');
                        return;
                    }
                    
                    const product = products[productIndex];
                    
                    // Update stock
                    if (type === 'out') {
                        products[productIndex].stock -= quantity;
                        if (products[productIndex].stock < 0) {
                            if (!confirm('Stok akan menjadi negatif. Lanjutkan?')) {
                                return;
                            }
                        }
                    } else {
                        products[productIndex].stock += quantity;
                    }
                    
                    await set(ref(database, 'products'), products);
                    
                    // Create transaction record
                    const now = new Date();
                    const transaction = {
                        date: now.toISOString().split('T')[0],
                        time: now.toTimeString().split(' ')[0],
                        timestamp: now.getTime(),
                        type: type,
                        productId: productId,
                        productName: product.name,
                        color: color,
                        size: size,
                        quantity: quantity,
                        price: type === 'out' ? (price || product.price) : 0,
                        cost: type === 'out' ? (cost || product.cost || 0) : 0,
                        total: type === 'out' ? quantity * (price || product.price) : 0,
                        profit: type === 'out' ? quantity * ((price || product.price) - (cost || product.cost || 0)) : 0,
                        customer: customer,
                        notes: notes,
                        user: 'Admin'
                    };
                    
                    await push(ref(database, 'transactions'), transaction);
                    
                    alert('Transaksi berhasil disimpan!');
                    transactionModal.classList.add('hidden');
                    
                    // Reload data
                    loadDailyTransactions();
                    loadDashboard();
                    if (!productsContent.classList.contains('hidden')) {
                        loadProducts();
                    }
                } catch (error) {
                    console.error("Gagal menyimpan transaksi:", error);
                    alert('Terjadi kesalahan saat menyimpan transaksi.');
                }
            });
            
            // Date filter handlers
            document.getElementById('filter-transaction-btn').addEventListener('click', function() {
                loadDailyTransactions();
            });
            
            document.getElementById('today-transaction-btn').addEventListener('click', function() {
                document.getElementById('transaction-date').value = today;
                loadDailyTransactions();
            });
            
            // Product management
            addProductBtn.addEventListener('click', function() {
                document.getElementById('modal-title').textContent = 'Tambah Produk Baru';
                document.getElementById('product-id').value = '';
                productForm.reset();
                productModal.classList.remove('hidden');
            });
            
            closeProductModal.addEventListener('click', function() {
                productModal.classList.add('hidden');
            });
            
            document.getElementById('cancel-product').addEventListener('click', function() {
                productModal.classList.add('hidden');
            });
            
            // Product form handler
            productForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const productId = document.getElementById('product-id').value;
                const productName = document.getElementById('product-name').value;
                const productPrice = parseInt(document.getElementById('product-price').value);
                const productCost = parseInt(document.getElementById('product-cost').value);
                const productStock = parseInt(document.getElementById('product-stock').value);
                const productCategory = document.getElementById('product-category').value;
                
                try {
                    const snapshot = await get(ref(database, 'products'));
                    let products = snapshot.val() || [];
                    
                    if (productId) {
                        // Edit existing product
                        const index = products.findIndex(p => p.id == productId);
                        if (index !== -1) {
                            products[index] = {
                                ...products[index],
                                name: productName,
                                price: productPrice,
                                cost: productCost,
                                stock: productStock,
                                category: productCategory
                            };
                        }
                    } else {
                        // Add new product
                        const newId = products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1;
                        products.push({
                            id: newId,
                            name: productName,
                            price: productPrice,
                            cost: productCost,
                            stock: productStock,
                            category: productCategory
                        });
                    }
                    
                    await set(ref(database, 'products'), products);
                    
                    productModal.classList.add('hidden');
                    if (productsContent.classList.contains('hidden')) {
                        loadDashboard();
                    } else {
                        loadProducts();
                    }
                    updateProductSelects();
                } catch (error) {
                    console.error("Gagal menyimpan produk:", error);
                    alert('Terjadi kesalahan saat menyimpan produk.');
                }
            });

            // Stock adjustment form handler
            stockAdjustmentForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const productId = parseInt(adjustProductSelect.value);
                const adjustType = document.getElementById('adjust-type').value;
                const adjustAmount = parseInt(document.getElementById('adjust-amount').value);
                const adjustNotes = document.getElementById('adjust-notes').value;
                
                if (!productId || isNaN(adjustAmount)) {
                    alert('Harap isi semua field dengan benar!');
                    return;
                }
                
                try {
                    const productsSnapshot = await get(ref(database, 'products'));
                    let products = productsSnapshot.val() || [];
                    const productIndex = products.findIndex(p => p.id == productId);
                    
                    if (productIndex === -1) {
                        alert('Produk tidak ditemukan!');
                        return;
                    }
                    
                    // Get current date
                    const now = new Date();
                    const dateStr = `${now.getDate()}/${now.getMonth()+1}/${now.getFullYear()} ${now.getHours()}:${now.getMinutes()}`;
                    
                    // Adjust stock
                    let oldStock = products[productIndex].stock;
                    let newStock = oldStock;
                    
                    if (adjustType === 'add') {
                        newStock = oldStock + adjustAmount;
                    } else if (adjustType === 'subtract') {
                        newStock = oldStock - adjustAmount;
                        if (newStock < 0) {
                            if (!confirm('Stok akan menjadi negatif. Lanjutkan?')) {
                                return;
                            }
                        }
                    } else if (adjustType === 'set') {
                        newStock = adjustAmount;
                    }
                    
                    // Update product stock
                    products[productIndex].stock = newStock;
                    await set(ref(database, 'products'), products);
                    
                    // Add to stock history
                    const stockHistoryData = {
                        productId: productId,
                        productName: products[productIndex].name,
                        date: dateStr,
                        type: adjustType,
                        amount: adjustAmount,
                        oldStock: oldStock,
                        newStock: newStock,
                        notes: adjustNotes,
                        user: 'Admin'
                    };
                    
                    await push(ref(database, 'stockHistory'), stockHistoryData);
                    
                    alert('Penyesuaian stok berhasil disimpan!');
                    // Reset form
                    document.getElementById('adjust-amount').value = '';
                    document.getElementById('adjust-notes').value = '';
                    
                    // Reload data
                    loadStockHistory();
                    loadDashboard();
                    if (!productsContent.classList.contains('hidden')) {
                        loadProducts();
                    }
                } catch (error) {
                    console.error("Gagal memperbarui stok:", error);
                    alert('Terjadi kesalahan saat memperbarui stok.');
                }
            });

            // Profit filter handler
            profitFilter.addEventListener('submit', function(e) {
                e.preventDefault();
                loadProfitData();
            });

            // Reset filter handler
            document.getElementById('reset-filter').addEventListener('click', function() {
                document.getElementById('filter-start-date').value = '';
                document.getElementById('filter-end-date').value = '';
                loadProfitData();
            });

            // Helper functions
            function hideAllContent() {
                dashboardContent.classList.add('hidden');
                dailyTransactionContent.classList.add('hidden');
                productsContent.classList.add('hidden');
                stockContent.classList.add('hidden');
                profitContent.classList.add('hidden');
            }

            async function updateProductSelects() {
                try {
                    const snapshot = await get(ref(database, 'products'));
                    const products = snapshot.val() || [];
                    
                    // Update adjust product select
                    adjustProductSelect.innerHTML = '';
                    transactionProductSelect.innerHTML = '';
                    
                    const defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = 'Pilih Produk';
                    defaultOption.selected = true;
                    defaultOption.disabled = true;
                    
                    adjustProductSelect.appendChild(defaultOption.cloneNode(true));
                    transactionProductSelect.appendChild(defaultOption);
                    
                    products.forEach(product => {
                        const option = document.createElement('option');
                        option.value = product.id;
                        option.textContent = `${product.name} (Stok: ${product.stock})`;
                        
                        adjustProductSelect.appendChild(option.cloneNode(true));
                        transactionProductSelect.appendChild(option);
                    });
                } catch (error) {
                    console.error("Gagal mengambil data products untuk select:", error);
                }
            }

            async function loadCurrentExpenses() {
                try {
                    const selectedDate = document.getElementById('expense-date').value;
                    const expenseSnapshot = await get(ref(database, `expenses/${selectedDate}`));
                    
                    if (expenseSnapshot.exists()) {
                        const expenses = expenseSnapshot.val();
                        document.getElementById('tax-expense').value = expenses.tax || 0;
                        document.getElementById('ads-expense').value = expenses.ads || 0;
                        document.getElementById('rent-expense').value = expenses.rent || 0;
                        document.getElementById('utility-expense').value = expenses.utility || 0;
                        document.getElementById('shipping-expense').value = expenses.shipping || 0;
                        document.getElementById('other-expense').value = expenses.other || 0;
                        document.getElementById('expense-notes').value = expenses.notes || '';
                    }
                } catch (error) {
                    console.error("Gagal mengambil data biaya:", error);
                }
            }

            async function loadDashboard() {
                try {
                    const productsSnapshot = await get(ref(database, 'products'));
                    const products = productsSnapshot.val() || [];
                    
                    const transactionsSnapshot = await get(ref(database, 'transactions'));
                    const allTransactions = Object.values(transactionsSnapshot.val() || {});
                    
                    const today = new Date().toISOString().split('T')[0];
                    const todayTransactions = allTransactions.filter(t => t.date === today && t.type === 'out');
                    
                    // Get today's expenses
                    const expenseSnapshot = await get(ref(database, `expenses/${today}`));
                    const todayExpenses = expenseSnapshot.exists() ? expenseSnapshot.val().total : 0;
                    
                    // Update summary cards
                    document.getElementById('total-products').textContent = products.length;
                    
                    const lowStockCount = products.filter(p => p.stock < 10).length;
                    document.getElementById('low-stock').textContent = lowStockCount;
                    
                    // Calculate today's profit (gross profit - expenses)
                    const todayRevenue = todayTransactions.reduce((sum, t) => sum + t.total, 0);
                    const todayCost = todayTransactions.reduce((sum, t) => sum + (t.quantity * (t.cost || 0)), 0);
                    const todayGrossProfit = todayRevenue - todayCost;
                    const todayNetProfit = todayGrossProfit - todayExpenses;
                    
                    document.getElementById('today-profit').textContent = 'Rp' + todayNetProfit.toLocaleString('id-ID');
                    
                    // Calculate today's items out
                    const todayItemsOut = todayTransactions.reduce((sum, t) => sum + t.quantity, 0);
                    document.getElementById('today-items-out').textContent = todayItemsOut;
                    
                    // Load today's transactions
                    const todayTransactionsContainer = document.getElementById('today-transactions');
                    todayTransactionsContainer.innerHTML = '';
                    
                    if (todayTransactions.length === 0) {
                        todayTransactionsContainer.innerHTML = '<p class="text-gray-500">Belum ada transaksi hari ini</p>';
                    } else {
                        const recentTransactions = todayTransactions.slice(-5).reverse();
                        recentTransactions.forEach(transaction => {
                            const transactionEl = document.createElement('div');
                            transactionEl.className = 'flex justify-between items-center p-2 bg-gray-50 rounded';
                            
                            transactionEl.innerHTML = `
                                <div>
                                    <div class="text-sm font-medium">${transaction.productName} - ${transaction.color} ${transaction.size}</div>
                                    <div class="text-xs text-gray-500">${transaction.time} - ${transaction.quantity} pcs</div>
                                </div>
                                <div class="text-sm font-bold text-green-600">Rp${transaction.total.toLocaleString('id-ID')}</div>
                            `;
                            
                            todayTransactionsContainer.appendChild(transactionEl);
                        });
                    }
                    
                    // Load top products today
                    const topProductsContainer = document.getElementById('top-products-today');
                    topProductsContainer.innerHTML = '';
                    
                    if (todayTransactions.length === 0) {
                        topProductsContainer.innerHTML = '<p class="text-gray-500">Belum ada penjualan hari ini</p>';
                    } else {
                        const productSales = {};
                        todayTransactions.forEach(t => {
                            if (!productSales[t.productId]) {
                                productSales[t.productId] = {
                                    name: t.productName,
                                    quantity: 0,
                                    total: 0
                                };
                            }
                            productSales[t.productId].quantity += t.quantity;
                            productSales[t.productId].total += t.total;
                        });
                        
                        const sortedProducts = Object.values(productSales).sort((a, b) => b.quantity - a.quantity).slice(0, 3);
                        
                        sortedProducts.forEach(product => {
                            const productEl = document.createElement('div');
                            productEl.className = 'flex justify-between items-center p-2 bg-gray-50 rounded';
                            
                            productEl.innerHTML = `
                                <div>
                                    <div class="text-sm font-medium">${product.name}</div>
                                    <div class="text-xs text-gray-500">${product.quantity} pcs terjual</div>
                                </div>
                                <div class="text-sm font-bold">Rp${product.total.toLocaleString('id-ID')}</div>
                            `;
                            
                            topProductsContainer.appendChild(productEl);
                        });
                    }
                } catch (error) {
                    console.error("Gagal mengambil data untuk dashboard:", error);
                }
            }

            async function loadDailyTransactions() {
                try {
                    const selectedDate = document.getElementById('transaction-date').value;
                    const transactionsSnapshot = await get(ref(database, 'transactions'));
                    const allTransactions = Object.values(transactionsSnapshot.val() || {});
                    
                    const filteredTransactions = allTransactions.filter(t => t.date === selectedDate);
                    
                    // Get expenses for the selected date
                    const expenseSnapshot = await get(ref(database, `expenses/${selectedDate}`));
                    const dailyExpenses = expenseSnapshot.exists() ? expenseSnapshot.val().total : 0;
                    
                    // Update summary cards
                    const dailyRevenue = filteredTransactions.filter(t => t.type === 'out').reduce((sum, t) => sum + t.total, 0);
                    const dailyCost = filteredTransactions.filter(t => t.type === 'out').reduce((sum, t) => sum + (t.quantity * (t.cost || 0)), 0);
                    const dailyGrossProfit = dailyRevenue - dailyCost;
                    const dailyNetProfit = dailyGrossProfit - dailyExpenses;
                    
                    document.getElementById('daily-revenue').textContent = 'Rp' + dailyRevenue.toLocaleString('id-ID');
                    document.getElementById('daily-cost').textContent = 'Rp' + dailyCost.toLocaleString('id-ID');
                    document.getElementById('daily-gross-profit').textContent = 'Rp' + dailyGrossProfit.toLocaleString('id-ID');
                    document.getElementById('daily-expenses').textContent = 'Rp' + dailyExpenses.toLocaleString('id-ID');
                    document.getElementById('daily-net-profit').textContent = 'Rp' + dailyNetProfit.toLocaleString('id-ID');
                    
                    // Load transactions table
                    transactionTableBody.innerHTML = '';
                    
                    if (filteredTransactions.length === 0) {
                        transactionTableBody.innerHTML = `
                            <tr>
                                <td colspan="9" class="px-6 py-4 text-center text-gray-500">Tidak ada transaksi untuk tanggal yang dipilih</td>
                            </tr>
                        `;
                    } else {
                        filteredTransactions.sort((a, b) => b.timestamp - a.timestamp);
                        
                        filteredTransactions.forEach(transaction => {
                            const tr = document.createElement('tr');
                            const typeClass = transaction.type === 'out' ? 'text-red-600' : 'text-green-600';
                            const typeText = transaction.type === 'out' ? 'Keluar' : 'Masuk';
                            
                            tr.innerHTML = `
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.time}</td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${transaction.type === 'out' ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                        ${typeText}
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.productName}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.color}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.size}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.quantity}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Rp${transaction.total.toLocaleString('id-ID')}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm ${transaction.profit > 0 ? 'text-green-600' : 'text-gray-900'}">
                                    ${transaction.type === 'out' ? 'Rp' + transaction.profit.toLocaleString('id-ID') : '-'}
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${transaction.customer || '-'}</td>
                            `;
                            
                            transactionTableBody.appendChild(tr);
                        });
                    }
                    
                    // Load color and size summaries
                    loadColorSizeSummaries(filteredTransactions.filter(t => t.type === 'out'));
                } catch (error) {
                    console.error("Gagal mengambil data transaksi:", error);
                }
            }

            function loadColorSizeSummaries(transactions) {
                const colorSummary = {};
                const sizeSummary = {};
                
                transactions.forEach(t => {
                    // Color summary
                    if (!colorSummary[t.color]) {
                        colorSummary[t.color] = { quantity: 0, total: 0 };
                    }
                    colorSummary[t.color].quantity += t.quantity;
                    colorSummary[t.color].total += t.total;
                    
                    // Size summary
                    if (!sizeSummary[t.size]) {
                        sizeSummary[t.size] = { quantity: 0, total: 0 };
                    }
                    sizeSummary[t.size].quantity += t.quantity;
                    sizeSummary[t.size].total += t.total;
                });
                
                // Display color summary
                const colorSummaryContainer = document.getElementById('color-summary');
                colorSummaryContainer.innerHTML = '';
                
                Object.entries(colorSummary).forEach(([color, data]) => {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center p-2 bg-gray-50 rounded';
                    div.innerHTML = `
                        <span class="font-medium">${color}</span>
                        <div class="text-right">
                            <div class="text-sm">${data.quantity} pcs</div>
                            <div class="text-xs text-gray-500">Rp${data.total.toLocaleString('id-ID')}</div>
                        </div>
                    `;
                    colorSummaryContainer.appendChild(div);
                });
                
                if (Object.keys(colorSummary).length === 0) {
                    colorSummaryContainer.innerHTML = '<p class="text-gray-500">Tidak ada data</p>';
                }
                
                // Display size summary
                const sizeSummaryContainer = document.getElementById('size-summary');
                sizeSummaryContainer.innerHTML = '';
                
                Object.entries(sizeSummary).forEach(([size, data]) => {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center p-2 bg-gray-50 rounded';
                    div.innerHTML = `
                        <span class="font-medium">${size}</span>
                        <div class="text-right">
                            <div class="text-sm">${data.quantity} pcs</div>
                            <div class="text-xs text-gray-500">Rp${data.total.toLocaleString('id-ID')}</div>
                        </div>
                    `;
                    sizeSummaryContainer.appendChild(div);
                });
                
                if (Object.keys(sizeSummary).length === 0) {
                    sizeSummaryContainer.innerHTML = '<p class="text-gray-500">Tidak ada data</p>';
                }
            }

            async function loadProducts() {
                try {
                    const snapshot = await get(ref(database, 'products'));
                    const products = snapshot.val() || [];
                    productTableBody.innerHTML = '';
                    
                    products.forEach(product => {
                        const tr = document.createElement('tr');
                        
                        tr.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 h-10 w-10 bg-gray-200 rounded-full flex items-center justify-center">
                                        <span class="text-gray-600">${product.name.charAt(0)}</span>
                                    </div>
                                    <div class="ml-4">
                                        <div class="text-sm font-medium text-gray-900">${product.name}</div>
                                        <div class="text-sm text-gray-500">ID: ${product.id}</div>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900 capitalize">${product.category}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">Rp${product.price.toLocaleString('id-ID')}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-900">Rp${product.cost.toLocaleString('id-ID')}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${product.stock < 10 ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                    ${product.stock}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                <button class="edit-product text-blue-600 hover:text-blue-900 mr-3" data-id="${product.id}">Edit</button>
                                <button class="delete-product text-red-600 hover:text-red-900" data-id="${product.id}">Hapus</button>
                            </td>
                        `;
                        
                        productTableBody.appendChild(tr);
                    });
                    
                    // Add event listeners for edit and delete buttons
                    document.querySelectorAll('.edit-product').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const productId = this.getAttribute('data-id');
                            editProduct(productId);
                        });
                    });
                    
                    document.querySelectorAll('.delete-product').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const productId = this.getAttribute('data-id');
                            deleteProduct(productId);
                        });
                    });
                } catch (error) {
                    console.error("Gagal mengambil data products:", error);
                }
            }

            async function editProduct(id) {
                try {
                    const snapshot = await get(ref(database, 'products'));
                    const products = snapshot.val() || [];
                    const product = products.find(p => p.id == id);
                    
                    if (product) {
                        document.getElementById('modal-title').textContent = 'Edit Produk';
                        document.getElementById('product-id').value = product.id;
                        document.getElementById('product-name').value = product.name;
                        document.getElementById('product-price').value = product.price;
                        document.getElementById('product-cost').value = product.cost;
                        document.getElementById('product-stock').value = product.stock;
                        document.getElementById('product-category').value = product.category;
                        
                        productModal.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error("Gagal mengambil data produk untuk edit:", error);
                }
            }

            async function deleteProduct(id) {
                if (confirm('Apakah Anda yakin ingin menghapus produk ini?')) {
                    try {
                        const snapshot = await get(ref(database, 'products'));
                        const products = snapshot.val() || [];
                        const filteredProducts = products.filter(p => p.id != id);
                        
                        await set(ref(database, 'products'), filteredProducts);
                        
                        loadProducts();
                        updateProductSelects();
                        loadDashboard();
                    } catch (error) {
                        console.error("Gagal menghapus produk:", error);
                        alert('Terjadi kesalahan saat menghapus produk.');
                    }
                }
            }

            async function loadStockHistory() {
                try {
                    const stockSnapshot = await get(ref(database, 'stockHistory'));
                    const history = Object.values(stockSnapshot.val() || {});
                    
                    const productsSnapshot = await get(ref(database, 'products'));
                    const products = productsSnapshot.val() || [];
                    
                    stockHistory.innerHTML = '';
                    
                    if (history.length === 0) {
                        stockHistory.innerHTML = '<p class="text-gray-500">Belum ada riwayat penyesuaian stok.</p>';
                        return;
                    }
                    
                    // Show only last 10 entries
                    const recentHistory = [...history].reverse().slice(0, 10);
                    
                    recentHistory.forEach(entry => {
                        const product = products.find(p => p.id == entry.productId);
                        const typeText = entry.type === 'add' ? 'Penambahan' : 
                                        entry.type === 'subtract' ? 'Pengurangan' : 'Penetapan';
                        
                        const entryEl = document.createElement('div');
                        entryEl.className = 'p-3 bg-gray-50 rounded';
                        
                        entryEl.innerHTML = `
                            <div class="flex justify-between items-start">
                                <div>
                                    <h4 class="font-medium">${product ? product.name : 'Produk dihapus'}</h4>
                                    <p class="text-sm text-gray-500">${typeText} stok: ${entry.amount}</p>
                                    <p class="text-sm text-gray-500">Stok: ${entry.oldStock} â†’ ${entry.newStock}</p>
                                    ${entry.notes ? `<p class="text-sm mt-1">Catatan: ${entry.notes}</p>` : ''}
                                </div>
                                <div class="text-xs text-gray-500">${entry.date}</div>
                            </div>
                        `;
                        
                        stockHistory.appendChild(entryEl);
                    });
                } catch (error) {
                    console.error("Gagal mengambil data stock history:", error);
                }
            }

            async function loadProfitData() {
                try {
                    const transactionsSnapshot = await get(ref(database, 'transactions'));
                    const allTransactions = Object.values(transactionsSnapshot.val() || {});
                    
                    const expensesSnapshot = await get(ref(database, 'expenses'));
                    const allExpenses = expensesSnapshot.val() || {};
                    
                    const startDate = document.getElementById('filter-start-date').value;
                    const endDate = document.getElementById('filter-end-date').value;
                    
                    let filteredTransactions = allTransactions.filter(t => t.type === 'out');
                    
                    if (startDate) {
                        filteredTransactions = filteredTransactions.filter(t => t.date >= startDate);
                    }
                    
                    if (endDate) {
                        filteredTransactions = filteredTransactions.filter(t => t.date <= endDate);
                    }
                    
                    // Group by date
                    const dailyData = {};
                    
                    filteredTransactions.forEach(t => {
                        if (!dailyData[t.date]) {
                            dailyData[t.date] = {
                                revenue: 0,
                                cost: 0,
                                grossProfit: 0,
                                expenses: 0,
                                netProfit: 0,
                                count: 0
                            };
                        }
                        
                        dailyData[t.date].revenue += t.total;
                        dailyData[t.date].cost += t.quantity * (t.cost || 0);
                        dailyData[t.date].count += 1;
                    });
                    
                    // Add expenses to daily data
                    Object.keys(dailyData).forEach(date => {
                        const dailyExpenses = allExpenses[date] ? allExpenses[date].total : 0;
                        dailyData[date].expenses = dailyExpenses;
                        dailyData[date].grossProfit = dailyData[date].revenue - dailyData[date].cost;
                        dailyData[date].netProfit = dailyData[date].grossProfit - dailyData[date].expenses;
                    });
                    
                    // Calculate totals
                    let totalRevenue = 0;
                    let totalCost = 0;
                    let totalExpenses = 0;
                    let totalNetProfit = 0;
                    
                    Object.values(dailyData).forEach(data => {
                        totalRevenue += data.revenue;
                        totalCost += data.cost;
                        totalExpenses += data.expenses;
                        totalNetProfit += data.netProfit;
                    });
                    
                    // Update summary cards
                    document.getElementById('total-revenue').textContent = 'Rp' + totalRevenue.toLocaleString('id-ID');
                    document.getElementById('total-cost').textContent = 'Rp' + totalCost.toLocaleString('id-ID');
                    document.getElementById('total-expenses').textContent = 'Rp' + totalExpenses.toLocaleString('id-ID');
                    document.getElementById('total-profit').textContent = 'Rp' + totalNetProfit.toLocaleString('id-ID');
                    
                    // Load table
                    profitTableBody.innerHTML = '';
                    
                    const sortedDates = Object.keys(dailyData).sort((a, b) => b.localeCompare(a));
                    
                    if (sortedDates.length === 0) {
                        profitTableBody.innerHTML = `
                            <tr>
                                <td colspan="6" class="px-6 py-4 text-center text-gray-500">Tidak ada data untuk periode yang dipilih</td>
                            </tr>
                        `;
                    } else {
                        sortedDates.forEach(date => {
                            const data = dailyData[date];
                            const tr = document.createElement('tr');
                            
                            const dateObj = new Date(date);
                            const formattedDate = `${dateObj.getDate()}/${dateObj.getMonth()+1}/${dateObj.getFullYear()}`;
                            
                            tr.innerHTML = `
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${formattedDate}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Rp${data.revenue.toLocaleString('id-ID')}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Rp${data.cost.toLocaleString('id-ID')}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-orange-600">Rp${data.expenses.toLocaleString('id-ID')}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600">Rp${data.netProfit.toLocaleString('id-ID')}</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${data.count}</td>
                            `;
                            
                            profitTableBody.appendChild(tr);
                        });
                    }
                } catch (error) {
                    console.error("Gagal mengambil data profit:", error);
                }
            }

        }, 1000); // Wait for Firebase to initialize
    </script>
</body>
</html>
